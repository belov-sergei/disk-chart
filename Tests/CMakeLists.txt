include("GoogleTest")

file(GLOB TEST_PROJECT_LIST RELATIVE ${CMAKE_CURRENT_LIST_DIR} "${CMAKE_CURRENT_LIST_DIR}/*")

# Each folder is considered a separate project with tests.
foreach(TEST_PROJECT_NAME ${TEST_PROJECT_LIST})
	set(TEST_PROJECT_PATH "${CMAKE_CURRENT_LIST_DIR}/${TEST_PROJECT_NAME}")

	if(NOT IS_DIRECTORY "${TEST_PROJECT_PATH}")
		continue()
	endif()

	CREATE_PROJECT(${TEST_PROJECT_NAME}
		SOURCES
			${TEST_PROJECT_PATH}
		INCLUDE_DIRECTORIES
			${TEST_PROJECT_PATH}
		SOURCE_GROUP
			${TEST_PROJECT_PATH}
		LINK_LIBRARIES
			Kernel
			gtest
		COMPILE_DEFINITIONS
			TEST_PROJECT_PATH="${TEST_PROJECT_PATH}"
	)

	gtest_discover_tests(${TEST_PROJECT_NAME})

	set_target_properties(${TEST_PROJECT_NAME} PROPERTIES FOLDER "Tests")
endforeach()